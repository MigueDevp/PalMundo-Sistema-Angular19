<div class="clients-container">
  <div class="header-section">
    <h2>Registro Global de Viajes <fa-icon [icon]="faSuitcase" /></h2>
    <hr />
    <app-button-add (click)="openModal()"> Añadir Viaje </app-button-add>
  </div>

  <!-- Error message display -->
  @if (error()) {
  <div class="error-message">
    {{ error() }}
    <button (click)="error.set(null)">×</button>
  </div>
  }

  <!-- Loading indicator -->
  @if (isLoading && viajes().length === 0) {
  <div class="loading-indicator"><span>⏳</span> Cargando viajes...</div>
  }

  <div class="table-container">
    <table class="clients-table">
      <thead>
        <tr>
          <th>Detalles</th>
          <th>Fechas</th>
          <th>Adelanto</th>
          <th class="incluye-item-p">Ultimo dia para pagar</th>
          <th class="incluye-item">Incluye</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @if (viajes().length === 0 && !isLoading) {
        <tr>
          <td colspan="5" class="no-data">
            No hay viajes registrados. ¡Agrega el primero haciendo clic en
            "Añadir Viaje"!
          </td>
        </tr>
        } @for (viaje of viajes(); track viaje.id_viaje) {
        <tr>
          <td>
            <div class="name-container">
              <div class="trip-name">{{ viaje.nombre_viaje }}</div>
              <div class="trip-key">
                {{ viaje.clave }}
              </div>
            </div>
          </td>
          <td>
            <div class="name-container">
              <div>Salida: {{ formatFecha(viaje.fecha_partida) }}</div>
              <div>Regreso: {{ formatFecha(viaje.fecha_regreso) }}</div>
            </div>
          </td>
          <td>
            <div class="name-container">
              <div>${{ viaje.cantidad_anticipo | number }}</div>
            </div>
          </td>
          <td>
            <div class="name-container">
              <div>{{ formatFecha(viaje.ultimo_dia_pagar) }}</div>
            </div>
          </td>
          <td>
            <div class="name-container">
              <div>{{ viaje.servicios_incluidos }} servicios incluidos</div>
            </div>
          </td>
          <td>
            <span
              class="status-badge"
              [ngClass]="getEstadoClass(viaje.estado_viaje ?? '')"
            >
              <span class="status-dot"></span>
              {{ viaje.estado_viaje }}
            </span>
          </td>
          <td class="actions">
            <app-actionsbuttons
              type="view"
              [disabled]="isLoading"
            ></app-actionsbuttons>
            <app-actionsbuttons
              type="edit"
              [disabled]="isLoading"
            ></app-actionsbuttons>
            <app-actionsbuttons
              type="delete"
              [disabled]="isLoading"
            ></app-actionsbuttons>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
